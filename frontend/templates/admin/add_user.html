{% extends 'admin/layout/sidebar.html' %}
{% load static %}

{% block title %}Dashboard | User Management{% endblock %}

{% block heading %}
<div class="page-heading">
  <h1>User Management</h1>
  <hr />
</div>
{% endblock %}

{% block content %}
<div class="procedure-dashboard">
  <div class="hero-cta standalone">
    <a class="btn btn-light" href="{% url 'create_new_user' %}">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <path d="M12 5v14m-7-7h14" />
      </svg>
      Add User
    </a>
  </div>

  <section class="data-surface" aria-label="User list table">
    <div class="table-wrapper elevated">
      <table class="procedure-table">
        <thead>
          <tr>
            <th scope="col">Employee ID</th>
            <th scope="col">Name</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody>
          <!-- Users will be loaded dynamically via JavaScript -->
        </tbody>
      </table>
    </div>
  </section>

</div>

<div id="userProfileModal" class="profile-modal" data-state="closed" role="dialog" aria-modal="true" aria-hidden="true"
  aria-labelledby="userProfileTitle">
  <div class="profile-modal__backdrop" data-close-modal></div>
  <div class="profile-modal__card" role="document">
    <button type="button" class="profile-modal__close icon-btn" aria-label="Close profile" data-close-modal>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"
        stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18" />
        <line x1="6" y1="6" x2="18" y2="18" />
      </svg>
    </button>
    <div class="profile-modal__body" data-profile-body>
      <!-- Content injected via JavaScript -->
    </div>
  </div>
</div>

<div id="editUserModal" class="edit-modal" data-state="closed" role="dialog" aria-modal="true" aria-hidden="true"
  aria-labelledby="editUserTitle">
  <div class="edit-modal__backdrop" data-close-edit-modal></div>
  <div class="edit-modal__card" role="document">
    <button type="button" class="edit-modal__close icon-btn" aria-label="Close edit user modal" data-close-edit-modal>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"
        stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18" />
        <line x1="6" y1="6" x2="18" y2="18" />
      </svg>
    </button>
    <div class="edit-modal__body">
      <div class="edit-modal__header">
        <h2 id="editUserTitle">Edit User</h2>
        <p>Update the user’s core details and their secure PIN.</p>
      </div>
      <form id="editUserForm" class="edit-form" novalidate>
        <div class="edit-form__row">
          <label class="edit-form__field">
            <span>Employee ID *</span>
            <input type="number" id="editEmpId" name="emp_id" placeholder="e.g. 1024" inputmode="numeric" required readonly />
            <small>Employee IDs can't be changed after creation.</small>
          </label>
          <label class="edit-form__field">
            <span>Name *</span>
            <input type="text" id="editName" name="name" placeholder="Full name" required readonly />
          </label>
        </div>
        <label class="edit-form__field">
          <span>Roles *</span>
          <div class="edit-multi-select">
            <button class="edit-select-box" type="button" data-edit-dropdown-toggle aria-haspopup="listbox" aria-expanded="false">
              <div id="edit-selected-items" class="is-empty">Select roles</div>
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" />
              </svg>
            </button>
            <div class="edit-options" role="listbox" aria-multiselectable="true">
              <label>
                <input type="checkbox" value="1" data-name="Administrator" data-edit-role-checkbox />
                <span>Administrator · Full access to all modules.</span>
              </label>
              <label>
                <input type="checkbox" value="2" data-name="Quality Control" data-edit-role-checkbox />
                <span>Quality Control · Manage quality control tasks.</span>
              </label>
              <label>
                <input type="checkbox" value="3" data-name="Tester" data-edit-role-checkbox />
                <span>Tester · Perform tests and log test data.</span>
              </label>
              <label>
                <input type="checkbox" value="4" data-name="Glueing" data-edit-role-checkbox />
                <span>Glueing · Manage glueing tasks.</span>
              </label>
              <label>
                <input type="checkbox" value="5" data-name="Cleaning" data-edit-role-checkbox />
                <span>Cleaning · Manage cleaning tasks.</span>
              </label>
              <label>
                <input type="checkbox" value="6" data-name="Spraying" data-edit-role-checkbox />
                <span>Spraying · Manage spraying tasks.</span>
              </label>
              <label>
                <input type="checkbox" value="7" data-name="Dispatch" data-edit-role-checkbox />
                <span>Dispatch · Manage dispatch tasks.</span>
              </label>
              <label>
                <input type="checkbox" value="8" data-name="Kit Verification" data-edit-role-checkbox />
                <span>Kit Verification · Verify kit components and assembly.</span>
              </label>
              <label>
                <input type="checkbox" value="9" data-name="SMD" data-edit-role-checkbox />
                <span>SMD · Manage surface mount device operations.</span>
              </label>
              <label>
                <input type="checkbox" value="10" data-name="SMD QC" data-edit-role-checkbox />
                <span>SMD QC · Quality control for SMD processes.</span>
              </label>
              <label>
                <input type="checkbox" value="11" data-name="Pre-Forming QC" data-edit-role-checkbox />
                <span>Pre-Forming QC · Quality control before forming stage.</span>
              </label>
              <label>
                <input type="checkbox" value="12" data-name="Leaded QC" data-edit-role-checkbox />
                <span>Leaded QC · Quality control for leaded components.</span>
              </label>
              <label>
                <input type="checkbox" value="13" data-name="Production QC" data-edit-role-checkbox />
                <span>Production QC · Overall production quality control.</span>
              </label>
            </div>
          </div>
          <small>Select one or more roles for this user.</small>
        </label>
        <label class="edit-form__field">
          <span>PIN *</span>
          <div class="otp-container edit-otp" data-edit-otp>
            <input
              type="password"
              class="otp-input"
              maxlength="1"
              data-edit-otp-input
              aria-label="PIN digit 1"
            />
            <input
              type="password"
              class="otp-input"
              maxlength="1"
              data-edit-otp-input
              aria-label="PIN digit 2"
            />
            <input
              type="password"
              class="otp-input"
              maxlength="1"
              data-edit-otp-input
              aria-label="PIN digit 3"
            />
            <input
              type="password"
              class="otp-input"
              maxlength="1"
              data-edit-otp-input
              aria-label="PIN digit 4"
            />
            <button
              type="button"
              class="pin-visibility-btn"
              data-edit-pin-toggle
              aria-pressed="false"
              aria-label="Show PIN"
            >
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path class="icon-eye-open" d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Zm11 3a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
                <path class="icon-eye-off" d="M2 3l20 18" />
              </svg>
            </button>
          </div>
          <input type="hidden" id="editPin" name="pin" />

        </label>
        <div class="edit-form__footer">
          <button type="button" class="btn ghost" data-close-edit-modal>Cancel</button>
          <button type="submit" class="btn" data-edit-submit>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <path d="M5 13l4 4L19 7" />
            </svg>
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/design.css' %}">
<link rel="stylesheet" href="{% static 'css/add_user.css' %}">
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/design.js' %}" defer></script>
<script src="{% static 'js/users.js' %}" defer></script>
{% endblock %}
