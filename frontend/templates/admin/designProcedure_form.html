{% extends 'admin/layout/sidebar.html' %}
{% load static %}

{% block title %}Add Design Process{% endblock %}

{% block heading %}
<h1>Production Procedure</h1>
<br />
<hr />
<br />
{% endblock %}

{% block content %}
<div class="page-shell">
  <div class="page-header">
    <div>
      <p class="page-eyebrow">
        Production 路 Procedure Designer
      </p>
      <h2 style="margin: 0">Add / Edit Production Procedure</h2>
    </div>
    <a class="btn" href="{% url 'design_procedure' %}">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <path d="M5 12h14M12 5l7 7-7 7" />
      </svg>
      Back to Procedures
    </a>
  </div>

  <section class="card procedure-form" aria-label="Procedure form">
    <form method="post">
      {% csrf_token %}
      <div class="form-row">
        <div>
          <label for="modelNo">Model No *</label>
          <input
            id="modelNo"
            name="model_no"
            type="text"
            placeholder="Enter model number"
            required
          />
        </div>
        <div>
          <label for="formImage">Upload Image</label>
          <div class="upload-dropzone is-compact" data-dropzone>
            <input
              id="formImage"
              name="form_image"
              type="file"
              accept=".jpg,.jpeg,.png,.gif"
            />
            <div class="upload-dropzone__content">
              <div class="upload-dropzone__icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <path d="M12 16V4m0 0l-3.5 3.5M12 4l3.5 3.5" />
                  <rect x="4" y="14" width="16" height="6" rx="2" />
                </svg>
              </div>
              <div>
                <p class="upload-dropzone__title">Upload image</p>
                <p class="helper-text" data-dropzone-label>PNG, JPG, GIF 路 10MB max</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div>
          <label for="qcVideo">Upload QC Video</label>
          <div class="upload-dropzone is-compact" data-dropzone>
            <input
              id="qcVideo"
              name="qc_video"
              type="file"
              accept=".mp4,.mov,.avi,.mkv"
            />
            <div class="upload-dropzone__content">
              <div class="upload-dropzone__icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <path d="M5 4h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6a2 2 0 012-2z" />
                  <path d="M10 9l5 3-5 3V9z" />
                </svg>
              </div>
              <div>
                <p class="upload-dropzone__title">Upload QC video</p>
                <p class="helper-text" data-dropzone-label>MP4, MOV, AVI, MKV 路 100MB max</p>
              </div>
            </div>
          </div>
        </div>
        <div>
          <label for="testingVideo">Upload Testing Video</label>
          <div class="upload-dropzone is-compact" data-dropzone>
            <input
              id="testingVideo"
              name="testing_video"
              type="file"
              accept=".mp4,.mov,.avi,.mkv"
            />
            <div class="upload-dropzone__content">
              <div class="upload-dropzone__icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                  <path d="M4 7h16M4 12h10M4 17h7" />
                  <circle cx="18" cy="17" r="2" />
                </svg>
              </div>
              <div>
                <p class="upload-dropzone__title">Upload testing video</p>
                <p class="helper-text" data-dropzone-label>MP4, MOV, AVI, MKV 路 100MB max</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div>
        <label>Part Numbers *</label>
        <div id="partEntries" class="grid" style="gap: 20px"></div>
        <button
          class="btn"
          type="button"
          style="margin-top: 20px"
          onclick="addPartEntry()"
        >
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-width="2" d="M12 5v14m-7-7h14" />
          </svg>
          Add Part
        </button>
      </div>

      <div class="submit-row">
        <button class="btn" type="submit">Save Procedure</button>
      </div>
    </form>
  </section>
</div>

<template id="partEntryTemplate">
  <div class="part-entry">
    <div class="form-row" style="align-items: flex-end">
      <div>
        <label>Part No</label>
        <select name="part_no[]" required onchange="handlePartSelection(this)">
          <option value="">Select Part Number</option>
          <option>PART-001</option>
          <option>PART-002</option>
          <option>PART-003</option>
          <option>PART-004</option>
          <option>PART-005</option>
          <option>PART-100</option>
          <option>PART-200</option>
          <option>PART-300</option>
        </select>
      </div>
      <button
        class="tiny-btn danger"
        type="button"
        aria-label="Remove part"
        onclick="removePart(this)"
      >
        &times;
      </button>
    </div>

    <div class="workflow-builder">
      <div class="chip">Workflow builder</div>

      <div class="workflow-card">
        <div class="workflow-items">

          <div class="workflow-item">
            <label class="checkbox-pill workflow-toggle">
              <input
                type="checkbox"
                data-panel-target="qc"
                onchange="togglePanel(this)"
              />
              SMD
            </label>
            <div class="detail-panel" data-panel="qc">
              <div class="panel-title">Default SMD Fields</div>
              <div class="token-list">
                <span class="token">SO Quantity</span>
                <span class="token">Available Quantity</span>
                <span class="token">Remaining Quantity</span>
              </div>
            </div>
          </div>

          <div class="workflow-item">
            <label class="checkbox-pill workflow-toggle">
              <input
                type="checkbox"
                data-panel-target="leaded"
                onchange="togglePanel(this)"
              />
              Leaded
            </label>
            <div class="detail-panel" data-panel="qc">
              <div class="panel-title">Default Leaded Fields</div>
              <div class="token-list">
                <span class="token">SO Quantity</span>
                <span class="token">Available Quantity</span>
                <span class="token">Remaining Quantity</span>
              </div>
            </div>
          </div>

          <div class="workflow-item">
            <label class="checkbox-pill workflow-toggle">
              <input
                type="checkbox"
                data-panel-target="prod_qc"
                onchange="togglePanel(this)"
              />
              Production QC
            </label>
            <div class="detail-panel" data-panel="qc">
              <div class="panel-title">Default Production QC Fields</div>
              <div class="token-list">
                <span class="token">SO Quantity</span>
                <span class="token">Available Quantity</span>
                <span class="token">Remaining Quantity</span>
              </div>
            </div>
          </div>

          <div class="workflow-item">
            <label class="checkbox-pill workflow-toggle">
              <input
                type="checkbox"
                data-panel-target="qc"
                onchange="togglePanel(this)"
              />
              QC
            </label>
            <div class="detail-panel" data-panel="qc">
              <div class="panel-title">Default QC Fields</div>
              <div class="token-list">
                <span class="token">USID</span>
                <span class="token">Incoming Batch No</span>
                <span class="token">In-Process Tag Number</span>
              </div>
              <div class="dual-panel" style="margin-top: 20px">
                <div class="panel-card">
                  <h4>Input Fields</h4>
                  <div class="pill-input-row">
                    <button class="tiny-btn" type="button" onclick="addInputField(this)">
                      +
                    </button>
                    <span>Add text field</span>
                  </div>
                  <div class="input-list"></div>
                </div>
                <div class="panel-card accent">
                  <h4>Checkboxes</h4>
                  <div class="pill-input-row">
                    <button class="tiny-btn" type="button" onclick="addCheckboxField(this)">
                      +
                    </button>
                    <span>Add checkbox</span>
                  </div>
                  <div class="input-list"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="workflow-item">
            <label class="checkbox-pill workflow-toggle">
              <input
                type="checkbox"
                data-panel-target="testing"
                onchange="togglePanel(this)"
              />
              Testing
            </label>
            <div class="detail-panel" data-panel="testing">
              <div class="panel-title">Testing Mode</div>
              <div class="form-row single">
                <div>
                  <label>Mode</label>
                  <select onchange="toggleTestingMode(this)">
                    <option value="">Select mode</option>
                    <option value="automatic">Automatic</option>
                    <option value="manual">Manual</option>
                  </select>
                </div>
              </div>
              <div class="token-list" style="margin: 16px 0">
                <span class="token">Serial Number</span>
                <span class="token">USID</span>
              </div>
              <div class="manual-only" style="display: none">
                <div class="dual-panel">
                  <div class="panel-card">
                    <h4>Input Fields</h4>
                    <div class="pill-input-row">
                      <button
                        class="tiny-btn"
                        type="button"
                        onclick="addInputField(this)"
                      >
                        +
                      </button>
                      <span>Add text field</span>
                    </div>
                    <div class="input-list"></div>
                  </div>
                  <div class="panel-card accent">
                    <h4>Manual Checks</h4>
                    <div class="pill-input-row">
                      <button
                        class="tiny-btn"
                        type="button"
                        onclick="addCheckboxField(this)"
                      >
                        +
                      </button>
                      <span>Add checkbox</span>
                    </div>
                    <div class="input-list"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="workflow-item">
            <label class="checkbox-pill workflow-toggle">
              <input
                type="checkbox"
                data-panel-target="glueing"
                onchange="togglePanel(this)"
              />
              Glueing
            </label>
            <div class="detail-panel" data-panel="glueing">
              <div class="panel-title">Glueing Defaults</div>
              <div class="token-list">
                <span class="token">Serial Number</span>
                <span class="token">USID</span>
              </div>
              <div class="dual-panel" style="margin-top: 20px">
                <div class="panel-card">
                  <h4>Additional Inputs</h4>
                  <div class="pill-input-row">
                    <button class="tiny-btn" type="button" onclick="addInputField(this)">
                      +
                    </button>
                    <span>Add text field</span>
                  </div>
                  <div class="input-list"></div>
                </div>
                <div class="panel-card accent">
                  <h4>Checklist</h4>
                  <div class="pill-input-row">
                    <button class="tiny-btn" type="button" onclick="addCheckboxField(this)">
                      +
                    </button>
                    <span>Add checkbox</span>
                  </div>
                  <div class="input-list"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="workflow-item">
            <label class="checkbox-pill workflow-toggle">
              <input
                type="checkbox"
                data-panel-target="cleaning"
                onchange="togglePanel(this)"
              />
              Cleaning
            </label>
            <div class="detail-panel" data-panel="cleaning">
              <div class="panel-title">Cleaning Defaults</div>
              <div class="token-list">
                <span class="token">Serial Number</span>
                <span class="token">USID</span>
              </div>
              <div class="dual-panel" style="margin-top: 20px">
                <div class="panel-card">
                  <h4>Additional Inputs</h4>
                  <div class="pill-input-row">
                    <button class="tiny-btn" type="button" onclick="addInputField(this)">
                      +
                    </button>
                    <span>Add text field</span>
                  </div>
                  <div class="input-list"></div>
                </div>
                <div class="panel-card accent">
                  <h4>Checklist</h4>
                  <div class="pill-input-row">
                    <button class="tiny-btn" type="button" onclick="addCheckboxField(this)">
                      +
                    </button>
                    <span>Add checkbox</span>
                  </div>
                  <div class="input-list"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="workflow-item">
            <label class="checkbox-pill workflow-toggle">
              <input
                type="checkbox"
                data-panel-target="spraying"
                onchange="togglePanel(this)"
              />
              Spraying
            </label>
            <div class="detail-panel" data-panel="spraying">
              <div class="panel-title">Spraying Defaults</div>
              <div class="token-list">
                <span class="token">Serial Number</span>
                <span class="token">USID</span>
              </div>
              <div class="dual-panel" style="margin-top: 20px">
                <div class="panel-card">
                  <h4>Additional Inputs</h4>
                  <div class="pill-input-row">
                    <button class="tiny-btn" type="button" onclick="addInputField(this)">
                      +
                    </button>
                    <span>Add text field</span>
                  </div>
                  <div class="input-list"></div>
                </div>
                <div class="panel-card accent">
                  <h4>Checklist</h4>
                  <div class="pill-input-row">
                    <button class="tiny-btn" type="button" onclick="addCheckboxField(this)">
                      +
                    </button>
                    <span>Add checkbox</span>
                  </div>
                  <div class="input-list"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="workflow-item dispatch-only" data-dispatch-item>
            <label class="checkbox-pill workflow-toggle dispatch-pill">
              <input
                type="checkbox"
                data-panel-target="dispatch"
                onchange="togglePanel(this)"
              />
              Dispatch
            </label>
            <div class="detail-panel" data-panel="dispatch" data-dispatch-panel>
              <div class="panel-title">Dispatch Defaults</div>
              <div class="token-list">
                <span class="token">Outgoing Batch No</span>
                <span class="token">Outgoing Serial No</span>
                <span class="token">Serial Number</span>
                <span class="token">USID</span>
              </div>
              <div class="dual-panel" style="margin-top: 20px">
                <div class="panel-card">
                  <h4>Additional Inputs</h4>
                  <div class="pill-input-row">
                    <button class="tiny-btn" type="button" onclick="addInputField(this)">
                      +
                    </button>
                    <span>Add text field</span>
                  </div>
                  <div class="input-list"></div>
                </div>
                <div class="panel-card accent">
                  <h4>Checklist</h4>
                  <div class="pill-input-row">
                    <button class="tiny-btn" type="button" onclick="addCheckboxField(this)">
                      +
                    </button>
                    <span>Add checkbox</span>
                  </div>
                  <div class="input-list"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/design.css' %}">
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/design.js' %}" defer></script>
{% endblock %}


